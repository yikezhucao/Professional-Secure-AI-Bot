{% extends "base.html" %}

{% block content %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<style>
    .chat-container {
        max-width: 800px;
        margin: 0 auto;
        height: calc(100vh - 100px);
        display: flex;
        flex-direction: column;
    }
    .chat-history {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 12px;
        margin-bottom: 20px;
    }
    .message {
        display: flex;
        margin-bottom: 16px;
        max-width: 100%;
    }
/* 用户消息特定样式 */
.user-message {
    justify-content: flex-end;
    margin-left: auto;
}
.user-message .message-content {
    background: #1890ff;
    color: white;
    border-radius: 18px 4px 18px 18px;
}

/* 机器人消息特定样式 */
.bot-message {
    justify-content: flex-start;
}
.bot-message .message-content {
    background: white;
    border: 1px solid #eee;
    border-radius: 4px 18px 18px 18px;
}

    .message-content {
        padding: 12px 16px;
        line-height: 1.5;
        border-radius: 18px;
        position: relative;
        word-break: break-word;
        hyphens: auto;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);

        max-width: 80%;
        min-width: 40px;
        width: fit-content;
    }
    .input-container {
        display: flex;
        gap: 10px;
        padding: 20px 0;
        background: white;
        position: sticky;
        bottom: 0;
    }
    #userInput {
        flex: 1;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
    }
    #sendButton {
        padding: 12px 24px;
        border-radius: 8px;
        background: #1890ff;
        border: none;
    }
</style>

<div class="chat-container">
    <div class="chat-history" id="chatArea">
        <div class="message bot-message">
            <div class="message-content">你好，我可以帮你写代码、读文件、写作各种创意内容，请把你的任务交给我吧~</div>
        </div>
    </div>

    <div class="input-container">
        <input type="text" id="userInput" class="form-control"
               placeholder="请输入您的问题..." autocomplete="off">
        <button id="sendButton" class="btn btn-primary">发送</button>
    </div>
</div>

<script>
    $(document).ready(function() {
        function createMessageElement(text, isUser) {
            const messageClass = isUser ? 'user-message' : 'bot-message';
            return $(
                `<div class="message ${messageClass}">
                    <div class="message-content">${text}</div>
                </div>`
            );
        }

        function sendMessage() {
            const userInput = $('#userInput');
            const question = userInput.val().trim();

            if (!question) return;

            // 添加用户消息
            $('#chatArea').append(createMessageElement(question, true));

            // 清空输入框
            userInput.val('');

            // 发送请求
            $.ajax({
                url: '{{ url_for(ajax_url) }}',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ question: question }),
                success: function(response) {
                    $('#chatArea').append(createMessageElement(response.answer, false));
                    // 滚动到底部
                    $('#chatArea').scrollTop($('#chatArea')[0].scrollHeight);
                },
                error: function() {
                    $('#chatArea').append(createMessageElement('抱歉，暂时无法处理您的请求', false));
                }
            });
        }

        $('#sendButton').click(sendMessage);
        $('#userInput').keypress(function(e) {
            if (e.which === 13 && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    });
</script>
{% endblock %}